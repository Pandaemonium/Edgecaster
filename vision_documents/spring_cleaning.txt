SPRING CLEANING — ACTIONABLE PLAN
(Current Status: Widget system online; VisualProfile + VisualEffect pipeline active)

Legend:
[CLEANUP] structure/no-behavior change
[BEHAVIOR] gameplay change
[VISION] long-term direction


===============================================================================
SLICE 1: Unified TargetMode [FOUNDATION COMPLETE]
✓ Tile / vertex / look targeting unified
✓ Mouse + keyboard symmetric
✓ Inspect mode uses entity inheritance

Next:
- Cone / line shapes
- Ranged preview layering
- Multi-step targeting for complex spells


===============================================================================
SLICE 2: Menu & UI System Rework [CLEANUP — ACTIVE]

Problem:
Menus, keybinds, inventory, and special scenes historically used ad-hoc layout
code and scene-specific hacks (especially for visuals).

New foundation:
✓ Panel-local rendering everywhere
✓ Scene-level VisualProfiles
✓ General VisualEffect system (named, stackable, recursive)
✓ Widget API introduced
✓ Overlay widget layers (SceneManager-owned; scenes opt-in)

Visual effects milestone:
✓ Introduced visual_effects.py as a central registry
✓ Clockwise / ghostly / mirror / shake / vibrate unified
✓ Inventory-specific visual hacks removed
✓ Effects now apply uniformly to scenes, popups, and entities
✓ Duplicate effects intentionally compound (fractal recursion)

Temporary scaffolding (do not let this linger):
- dungeon.py still contains an F8 debug overlay used to validate widget input
  interception. Keep as fallback until HUD + AbilityBar widgetization is stable,
  then remove.

Migration order (stay disciplined):
1) HUD → widget in its own file (overlay layer)
2) Ability Bar → widgetized + preserve clickiness
3) MenuScene → generalized widget-based menus
   (keep MenuScene classic as a thin legacy wrapper during migration)


===============================================================================
SLICE 3: Data-Driven Everything [VISION]

- Expand prototypes with materials, physiology, resistances
- Behavior components (curious, brittle, fractal, volatile)
- Procedural pantheons and lore via inheritance chains
- Conditions/adjectives system that can attach gameplay + visual effects
  (e.g. "Fiery" condition → fiery VisualEffect)


===============================================================================
CURRENT TACTICAL FOCUS (UI / SCENE LAYER)

→ Finish widget primitives (Label, Button, List)
→ Flexible menu layouts (two-pane, mixed text/graphics)
→ InventoryScene → widget-based (list + details)
→ KeybindsScene → data-driven grid widget
→ Normalize visual style across all menus
→ Keep all visual effects registry-driven (no scene-specific hacks)


===============================================================================
ONGOING ENGINE CLEANUPS

1) [CLEANUP] Decompose game.py into systems/*
2) [CLEANUP] Scheduler/event semantics cleanup
3) [CLEANUP] MessageLog performance (deque)
4) [CLEANUP] Dataclass defaults & typing consistency
5) [CLEANUP] Actor/entity identification consistency
6) [CLEANUP] Level registry invariants
7) [CLEANUP] Kill-path ID consistency
8) [CLEANUP] Overmap thread safety
9) [CLEANUP] Centralize tuning constants
10) [CLEANUP] Inventory/entity lookup optimizations
11) [CLEANUP] Actor/entity position indexes
12) [CLEANUP] Normalize content-file resolution
13) [CLEANUP] Remove leftover debug scaffolding
14) [CLEANUP] Explicit initialization pipeline
15) [CLEANUP] Tighten scheduler typing
16) [CLEANUP] Unify ignite/regrow effect logic
17) [CLEANUP] Distinguish movement vs LOS blocking


-------------------------------------------------------------------------------
Guiding principles:
Keep the geometry weird.
Keep responsibilities clean.
Refactor early, but surgically.
