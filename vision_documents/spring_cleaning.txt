SPRING CLEANING – ACTIONABLE PLAN (CURRENT STATUS: ABILITY BAR EXTRACTED)
Legend: [CLEANUP] structural/no-behavior change; [BEHAVIOR] gameplay change; [VISION] future/idea.
Updated after refactor of the Ability Bar into a standalone UI widget.

===============================================================================
SLICE 1: Renderer / Input Untangle [CLEANUP] — COMPLETE ENOUGH FOR NOW
Goal: ascii.py is draw-only; scenes own all input and UI logic.

Current status:
✓ ascii.py now owns NO input
✓ All input → GameInput → GameCommand → DungeonScene._handle_command
✓ Renderer only computes hitboxes and draws
Remaining impurities: dialog UI + config UI still partly in ascii.py

Next micro-steps:
- Move dialog/config selection state from ascii.py into dedicated scene models
- Renderer should receive view-models only

===============================================================================
SLICE 2: Ability Bar Overhaul [CLEANUP] — BASELINE COMPLETE
Goal: renderer-agnostic ability system driven entirely by Actions.

Current status:
✓ AbilityBarState implemented and scene-owned
✓ AbilityBarRenderer view-only, ascii.py just calls draw()
✓ systems/actions.py defines canonical actions (with show_in_bar)
✓ systems/abilities.py builds abilities from game + host actor
✓ DungeonScene handles ALL ability activation logic

Next micro-steps:
- Remove remaining legacy renderer ability code (icon helpers optional)
- Add a small AbilityConfigScene in the future if needed

===============================================================================
SLICE 3: Targeting System Generalization [CLEANUP/BEHAVIOR] — NEXT PRIORITY
Goal: a single TargetMode for all targeted actions (terminus placement, activate-all,
activate-seed, future “look”, projectiles, teleports, etc.)

Plan:
1) Introduce a TargetState model on DungeonScene:
   active, kind ("tile" | "vertex"), action, cursor tile, origin, optional range
2) While active → movement keys move cursor, not player
3) Confirm (Enter/Space/click) → route to appropriate action
4) Cancel (Esc/right-click) → exit target mode
5) Renderer draws target cursor but owns no targeting logic

When complete:
- No special-case “terminus mode” or “aim mode”
- Keyboard + mouse parity for ALL targeted actions

===============================================================================
SLICE 4: Custom Fractal Pipeline [CLEANUP]
Goal: unified editor, correct click alignment, consistent saves.

Current status:
✓ Ability bar responds to custom fractals through signature invalidation
Next:
- Factor editor to return definitive vertices/edges dict
- Ensure click-to-world alignment is identical in windowed/fullscreen

===============================================================================
SLICE 5: Inventory Cleanup [CLEANUP]
Goal: per-entity inventories with clear helpers.

Current status:
✓ Core helper APIs implemented in game.py
✓ Nested containers supported
Next:
- Additional UI polish in InventoryScene
- Consider simple item stacking

===============================================================================
SLICE 6: Data-Driven Entities [CLEANUP/BEHAVIOR]
Goal: all entities (items, berries, containers, objects) defined by YAML.

Current status:
✓ entities.yaml + factory in place
✓ Berries/containers generated from templates
Next:
- Expand component-style properties (HP, tags, behaviors)
- Move remaining hardcoded objects into content layer

===============================================================================
Deferred / Vision Targets
- [VISION] Full renderer swapability (ASCII → tiles)
- [VISION] Spell/action effects as “effect entities”
- [VISION] Procedural spawn tables
- [VISION] Behavior trees for AI

===============================================================================
Current tactical focus:
→ IMPLEMENT UNIFIED TARGETMODE (SLICE 3)
Everything else builds more cleanly once targeting is consistent.

:contentReference[oaicite:0]{index=0}
