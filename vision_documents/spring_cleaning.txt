SPRING CLEANING – ACTIONABLE PLAN
(Current Status: Ability Bar Fully Extracted, Abilities Now Entity-Driven)
Legend: [CLEANUP] structural/no-behavior change; [BEHAVIOR] gameplay change; [VISION] future/idea.

===============================================================================
SLICE 1: Renderer / Input Untangle [CLEANUP] — COMPLETE ENOUGH FOR NOW
Goal: ascii.py is draw-only; scenes own all input and UI logic.

Status:
✓ ascii.py now owns NO input
✓ Input → GameInput → GameCommand → DungeonScene._handle_command
✓ Renderer only computes hitboxes and draws
Remaining impurities:
- Dialog + Config UI still have small logic remnants in ascii.py

Next micro-steps:
- Move dialog/config state out of ascii.py into dedicated small scene models
- Renderer should receive view-models only

===============================================================================
SLICE 2: Ability Bar Overhaul [CLEANUP] — **MAJOR UPDATE COMPLETE**
Goal: Ability system renderer-agnostic and driven entirely by Actions defined in actions.py.

Status:
✓ AbilityBarState implemented (scene-owned)
✓ AbilityBarRenderer is pure view
✓ actions.py defines all action metadata (show_in_bar, icons, colors, sub-buttons)

NEW (IMPORTANT):
✓ **Ability bar now reflects the current host actor’s `actions` list.**
  - Body-swapping instantly updates the bar.
  - Only actions with show_in_bar=True appear.
  - Future classes and monsters inherit abilities automatically.

✓ **Kochbender fractal kit is now added via entity.actions at spawn time.**
  - Currently done hackily during player instantiation in game.py.
  - Ultimately should be expressed via character generation + entity templates.

Next micro-steps:
- Roll class-specific action lists into character generation pipelines
- Replace hacky player spawn action injection with a clean class component

===============================================================================
SLICE 3: Targeting System Generalization [CLEANUP/BEHAVIOR] — NEXT PRIORITY
Goal: One unified TargetMode for all targeted actions.

Plan:
1) Introduce a TargetState struct on DungeonScene
2) Movement keys move cursor while active
3) Confirm → resolve + dispatch
4) Cancel → exit
5) Renderer only draws the cursor; no logic inside ascii.py

Benefits:
- Removes legacy “terminus mode” and “aim mode”
- Fully unifies keyboard + mouse targeting

===============================================================================
SLICE 4: Custom Fractal Pipeline [CLEANUP]
Status:
✓ Ability bar correctly opens fractal editor via action metadata
Next:
- Ensure editor returns unified vertices/edges dict
- Align all clicks consistently in fullscreen and windowed modes

===============================================================================
SLICE 5: Inventory Cleanup [CLEANUP]
Status:
✓ Nested containers implemented
✓ InventoryScene functional

Next:
- UI polish (left-justification, footer clipping fix)
- Consider stackable items

===============================================================================
SLICE 6: Data-Driven Entities [CLEANUP/BEHAVIOR]
Goal: All entities via YAML → factory instantiation.

Status:
✓ entities.yaml and enemy_factory fully in place
✓ All monsters derived from YAML templates
✓ Containers, berries, environmental objects cleanly data-driven

Next:
- Expand template “components”
- Migrate hardcoded actor stats into templates where appropriate

===============================================================================
Deferred / Vision Targets
- Full renderer swapability (ASCII → tiles)
- Spell/action effects as entities
- Procedural spawn tables
- Behavior-tree AI

===============================================================================
Current tactical focus:
→ **IMPLEMENT UNIFIED TARGETMODE (SLICE 3)**  
Ability bar + action metadata are stable. Targeting is the last big unification step.
