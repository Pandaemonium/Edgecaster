SPRING CLEANING â€“ ACTIONABLE PLAN
(Current Status: Ability Bar Fully Extracted, Abilities Now Entity-Driven)
Legend: [CLEANUP] structural/no-behavior change; [BEHAVIOR] gameplay change; [VISION] future/idea.

===============================================================================
SLICE 1: Renderer / Input Untangle [CLEANUP] â€” COMPLETE ENOUGH FOR NOW
Goal: ascii.py is draw-only; scenes own all input and UI logic.

Status:
âœ“ ascii.py now owns NO input
âœ“ Input â†’ GameInput â†’ GameCommand â†’ DungeonScene._handle_command
âœ“ Renderer only computes hitboxes and draws
Remaining impurities:
- Dialog/config drawing still lives in ascii.py but state is now scene-owned (DungeonUIState)
- Lorenz integration/trails still renderer-owned

Next micro-steps:
- Move Lorenz integration/state into lorenz.py/game; renderer consumes view-only positions

===============================================================================
SLICE 2: Ability Bar Overhaul [CLEANUP] â€” **MAJOR UPDATE COMPLETE**
Goal: Ability system renderer-agnostic and driven entirely by Actions defined in actions.py.

Status:
âœ“ AbilityBarState implemented (scene-owned)
âœ“ AbilityBarRenderer is pure view
âœ“ actions.py defines all action metadata (show_in_bar, icons, colors, sub-buttons)

NEW (IMPORTANT):
âœ“ **Ability bar now reflects the current host actorâ€™s `actions` list.**
  - Body-swapping instantly updates the bar.
  - Only actions with show_in_bar=True appear.
  - Future classes and monsters inherit abilities automatically.

âœ“ **Kochbender fractal kit is now added via entity.actions at spawn time.**
  - Currently done hackily during player instantiation in game.py.
  - Ultimately should be expressed via character generation + entity templates.

Next micro-steps:
- Roll class-specific action lists into character generation pipelines
- Replace hacky player spawn action injection with a clean class component

===============================================================================
SLICE 3: Targeting System Generalization [CLEANUP/BEHAVIOR] â€” NEXT PRIORITY
Goal: One unified TargetMode for all targeted actions.

Plan:
1) Introduce a TargetState struct on DungeonScene
2) Movement keys move cursor while active
3) Confirm â†’ resolve + dispatch
4) Cancel â†’ exit
5) Renderer only draws the cursor; no logic inside ascii.py

Benefits:
- Removes legacy â€œterminus modeâ€ and â€œaim modeâ€
- Fully unifies keyboard + mouse targeting

===============================================================================
SLICE 4: Custom Fractal Pipeline [CLEANUP]
Status:
âœ“ Ability bar correctly opens fractal editor via action metadata
Next:
- Ensure editor returns unified vertices/edges dict
- Align all clicks consistently in fullscreen and windowed modes

===============================================================================
SLICE 5: Inventory Cleanup [CLEANUP]
Status:
âœ“ Nested containers implemented
âœ“ InventoryScene functional

Next:
- UI polish (left-justification, footer clipping fix)
- Consider stackable items

===============================================================================
SLICE 6: Data-Driven Entities [CLEANUP/BEHAVIOR]
Goal: All entities via YAML â†’ factory instantiation.

Status:
âœ“ entities.yaml and enemy_factory fully in place
âœ“ All monsters derived from YAML templates
âœ“ Containers, berries, environmental objects cleanly data-driven

Next:
- Expand template â€œcomponentsâ€
- Migrate hardcoded actor stats into templates where appropriate

===============================================================================
Deferred / Vision Targets
- Full renderer swapability (ASCII â†’ tiles)
- Spell/action effects as entities
- Procedural spawn tables
- Behavior-tree AI

===============================================================================
Current tactical focus:
â†’ **IMPLEMENT UNIFIED TARGETMODE (SLICE 3)**  
Ability bar + action metadata are stable. Targeting is the last big unification step.

- Lorenz integration moved to game/lorenz; renderer now only draws provided points/trails

